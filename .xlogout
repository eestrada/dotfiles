#!/bin/sh

# run anything we want to run right before an X11 session ends.

# Based on: https://www.reddit.com/r/voidlinux/comments/lkjs6z/comment/go0hnxg/
# works for both chrome and chromium
# TODO: find a place in openrc/init to do this same thing so that a script isn't needed.
printf '%s\n' 'Attempting to gracefully kill chromium...' 1>&2
pkill --oldest -x chrome
pid=$(pgrep --oldest -x chrome)
while kill -0 "${pid}"; do sleep 1; done
printf '%s\n' 'chromium killed!' 1>&2

# Kill the debus session started in .xinitrc
if [ -n "$DBUS_SESSION_BUS_PID" ]; then
  kill "$DBUS_SESSION_BUS_PID"
  while kill -0 "$DBUS_SESSION_BUS_PID"; do sleep 1; done
fi
